<% title "Albums", false %>

<!--
<div class="description">
  Albums
</div>
-->

<div class='index_header'>
  <span class='title'>List of albums</span>
  (<%= link_to "add a new album", new_admin_album_path %>)
</div>

<div id="albums" class="index_container">
  <% if @albums.empty? %>
  Please add a new album
  <% else %>
  <%- for album in @albums -%>
  <div id="album_<%= album.id %>" class="index_item ajax_photo_item">
    <div class="handle"><img src="/images/icons/order.png" alt="[+]"></div>
    <div class="thumbnail"><%= image_tag album.album_cover(:small) %></div>
    <div class="title">
      <%=h album.title %> 
      <span class="warning"><%=h "(#{album.photos.length} photos)" %></span>
    </div>
    <div class="actions">
      <%= link_to 'View', [:admin, album] %> | 
      <%= link_to 'Edit', edit_admin_album_path(album) %> | 
      <%= link_to 'Delete this album', admin_album_path(album), :confirm => 'Are you sure?', :method => :delete %>
    </div>
    <div class="clear_fix"></div>
  </div>
  <%- end -%>
  <%- end -%>
</div>

<% content_for :foot do %>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function(){
    $('#albums').sortable({
      axis: 'y',
      dropOnEmpty: false,
      handle: '.handle',
      cursor: 'move',
      items: '.ajax_photo_item',
      opacity: 0.4,
      scroll: true,
      update: function(){
        $.ajax({
          type: 'post',
          data: $('#albums').sortable('serialize'),
          dataType: 'script',
          complete: function(request){
            $('#albums').effect('highlight');
          },
          url: "<%= sort_admin_albums_path %>"})
        }
      });
  });
</script>
<% end %>
